## 6.1 Sesiónes y cookies

Las Sesiones y las cookies son dos conceptos comunes en la navegación web, también son muy fáciles de entender mal, pero son extremadamente importantes en la autorización y las estadísticos de las páginas. Vamos a comprender los dos.

Suponga que desea rastrear una página con acceso limitado, al igual que la página de inicio del usuario en twitter. Por supuesto, usted puede abrir su navegador y escribir su nombre de usuario y contraseña para iniciar sesión y acceder a los datos, pero lo que llamamos "crawl" significa que usamos un programa para simular este proceso sin intervención humana. Por lo tanto, tenemos que averiguar lo que realmente está sucediendo detrás de nuestras acciones cuando utilizamos el navegador para realizar el login.

Cuando nos registramos en la página, al tipear el nombre de usuario y contraseña y se pulsa el botón "Iniciar sesión", el navegador envía una solicitud POST al servidor remoto. El navegador nos redirige a la página principal después de que el servidor nos devuelve una respuesta correcta. La pregunta es ¿cómo el servidor saber que tenemos derecho a abrir la página con acceso limitado? Debido a que HTTP no tiene estado, el servidor no tiene ninguna manera de saber que pasamos la verificación en la última etapa. La solución más sencilla es anexar el nombre de usuario y contraseña en la URL, funciona pero nos va a dar demasiado trabajo al servidor (al tener que verificar todas las solicitudes en la base de datos), y cuenta con una experiencia de usuario terrible. Así que sólo hay una manera de lograr este objetivo, que es salvar lla información de la identificación, ya sea en el servidor o en el cliente, es por eso que tenemos las cookies y las sesiones.

cookie, en definitiva se trata de un historial de información (incluyendo la información del login) que se guarda en la computadora del cliente y el navegador envía la mismas cookies cuando el usuario visita la próxima vez el mismo sitio web, finaliza automáticamente  el paso del login para el usuario.


![](images/6.1.cookie2.png?raw=true)

Figura 6.1 Principios de las cookies.

sesiones, en resumen, es la información del historial que se guarda en el servidor, servidor utiliza ID de sesión para identificar diferentes sesiones, y el identificador de sesión se produce por el servidor, se debe mantener al azar y único, puede utilizar cookies para obtener la identidad del cliente, o por URL como argumentos.

![](images/6.1.session.png?raw=true)

Figure 6.2 Principio de sesiones.

## Cookie

CCookies se mantiene por los navegadores y junto con las solicitudes entre los servidores web y navegadores. Aplicación web puede acceder a la información cookies cuando el usuario visita el sitio. En la configuración del explorador hay uno acerca de las cookies de privacidad, y usted debería ver algo similar de la siguiente manera cuando se abre:

![](images/6.1.cookie.png?raw=true)

Figure 6.3 cookies en los navegadores.

Cookies ha expirado el tiempo, y hay dos tipos de cookies basado en periodo de vida: cookie de sesión y cookies persistentes.

Si no se establece el tiempo ha expirado, el navegador no lo guardará en un archivo local después de cerrar el navegador, se llama cookies de sesión; este tipo de galletas se suelen guardar en la memoria en lugar del sistema de archivos local.

Si establece el tiempo expirado (setMaxAge (60 * 60 * 24)), el navegador guardará esta imagen Galletas en el sistema de archivos local, y no se eliminará hasta que llegado el tiempo ha expirado. Las cookies que se guardan en el sistema de archivos local se pueden compartir en diferentes procesos de los navegadores, por ejemplo, dos ventanas de IE; diferentes tipos de navegadores utilizan diferentes procesos para el manejo de cookies que se almacena en la memoria.  　　

## Establecer las cookies en Go

Go utiliza la función `SetCookie` en el package `net/http` to set cookie:

	http.SetCookie(w ResponseWriter, cookie *Cookie)

`w`  es la respuesta de la solicitud, cookie es una estructura, vamos a ver cómo se ve así:

	type Cookie struct {
	    Name       string
	    Value      string
	    Path       string
	    Domain     string
	    Expires    time.Time
	    RawExpires string
	
	// MaxAge=0 means no 'Max-Age' attribute specified.
	// MaxAge<0 means delete cookie now, equivalently 'Max-Age: 0'
	// MaxAge>0 means Max-Age attribute present and given in seconds
	    MaxAge   int
	    Secure   bool
	    HttpOnly bool
	    Raw      string
	    Unparsed []string // Raw text of unparsed attribute-value pairs
	}

Aquí está un ejemplo de configuración de cookies:

	expiration := *time.LocalTime()
	expiration.Year += 1
	cookie := http.Cookie{Name: "username", Value: "astaxie", Expires: expiration}
	http.SetCookie(w, &cookie)
　　

## Optener cookie en Go

El ejemplo anterior muestra cómo configurar las cookies, vamos a ver cómo conseguir cookie:

	cookie, _ := r.Cookie("username")
	fmt.Fprint(w, cookie)

Aquí hay otra manera de conseguir cookie:

	for _, cookie := range r.Cookies() {
	    fmt.Fprint(w, cookie.Name)
	}

Como se puede ver, es muy conveniente para llegar cookies en la solicitud.

## Sesion

Sesión significa una serie de acciones o mensajes, por ejemplo, sus acciones de recoger su teléfono para colgar se puede llamar a una sesión. Sin embargo, la sesión implícito orientado a conexión o mantener la conexión cuando está relacionado con la red de protocolo.

Sesión tiene más sentido cuando golpea el desarrollo web, lo que significa una solución que mantenga el estado de conexión entre el servidor y el cliente, a veces también significa la estructura de almacenamiento de datos de esta solución.

Sesión es el mecanismo lado del servidor, servidor utiliza algo así como (o en realidad) utilice la tabla hash para guardar la información.

Cuando una aplicación tiene que asignar una nueva sesión para el cliente, el servidor debe comprobar si hay alguna sesión de un mismo cliente con ID Única sesión. Si el identificador de sesión que ya ha existido, el servidor sólo devuelve el mismo período de sesiones de cliente, cree una nueva sesión si no hay nadie para ese cliente (por lo general ocurre cuando el servidor ha borrado correspondiente identificador de sesión, pero el usuario añada sesión ole manualmente).

La sesión en sí no es compleja, pero su implementación y despliegue son muy complicados, por lo que no se puede utilizar "una forma para gobernarlos a todos".

## Resumen

En conclusión, el objetivo de la sesión y de la galleta es la misma, que son a la vez para superar defecto de HTTP sin estado, pero utilizan diferentes maneras. Sesión utiliza cookies para guardar identificador de sesión en el lado del cliente, y guardar otros datos en el lado del servidor, y de la galleta guarda toda la información en el lado del cliente. Así que usted puede notar que la galleta tiene algunos problemas de seguridad, por ejemplo, nombre de usuario y la contraseña pueden ser descifradas y recogidos por otros sitios.

Hay dos ejemplos:
 establecer cookies inesperado para appB.
2. XSS, appA utiliza JavaScript `document.cookie` para acceder a las cookies de appB.

A través de la introducción de esta sección, usted debe saber los conceptos básicos de la galleta y la sesión, comprender las diferencias entre ellos, para que no te mates cuando los insectos salen. Vamos a obtener más detalles acerca de la sesión en las siguientes secciones.

## Enlaces

- [Indice](preface.md)
- Sección anterior: [Almacenamiento de datos y sesiones](06.0.md)
- Siguiente sección: [Como usar sesiones en Go](06.2.md)